generator client {
  provider = "prisma-client"
  output   = "generated/prisma"
   previewFeatures     = ["driverAdapters", "queryCompiler", "relationJoins"]
  runtime             = "nodejs"
}

datasource db {
  provider = "postgresql"
}

model Journal {
  id        String   @id @default(cuid())
  title     String?
  content   String
  tradeId   String?  @unique // unique link to a trade
  owner     String   // wallet address of the journal owner (base58)
  symbol    String?
  side      String?
  pnl       Float?
  pnlPct    Float?   @map("pnlPercentage")
  transactionHash String?
  tradeTimestamp DateTime?
  tags      String[] @default([])
  aiAnalyzed Boolean   @default(false)
  
  // AI Coach & Analytics Fields
  aiInsights Json?    // Structured AI feedback (performanceCritique, emotionalReview, etc.)
  riskScore  Float?   // 0-100 risk score based on trade params
  magicTags  String[] @default([]) // AI-generated tags like #FOMO, #Revenge

  // New Sweet Features
  mood       String?  // E.g. "Confident", "Anxious", "Neutral"
  images     String[] @default([]) // Array of image URLs

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([owner])
  @@index([tradeId])
}

model WalletSyncState {
  id            String   @id @default(cuid())
  owner         String   @unique // wallet address
  lastSignature String?  
  lastSyncedAt  DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([owner])
}

model Trade {
  id              String   @id // uniqueId (signature-index)
  owner           String   // Wallet address
  timestamp       DateTime
  section         String?
  symbol          String
  side            String
  entryPrice      Float
  exitPrice       Float
  quantity        Float
  amount          Float?
  value           Float?
  orderType       String?  
  instrument      String?
  clientId        String
  orderId         String
  transactionHash String
  
  // Fees flattened
  makerFee        Float?   @default(0)
  takerFee        Float?   @default(0)
  totalFee        Float    @default(0)
  rebates         Float?   @default(0)
  fundingFee      Float?   @default(0)
  socializedLossFee Float? @map("socializedLoss") @default(0)
  
  // Basic properties
  pnl             Float    @default(0)
  pnlPercentage   Float    @default(0)
  duration        Float    @default(0)
  status          String   @default("breakeven")
  
  notes           String?
  tradeType       String?
  fundingPayments Float?
  logType         String?
  discriminator   Int?
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([owner])
  @@index([owner, timestamp(sort: Desc)])
}
